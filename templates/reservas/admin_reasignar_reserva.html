{% load i18n %}
{% load static %}

<h3 class="mb-3">{% trans "Reasignar reserva" %} #{{ reserva.id }}</h3>

<div class="card mb-3">
  <div class="card-body">
    <p class="mb-1"><strong>{% trans "Mesa actual" %}:</strong> {{ reserva.mesa.numero }} (cap {{ reserva.mesa.capacidad }})</p>
    <p class="mb-1"><strong>{% trans "Horario" %}:</strong> {{ reserva.fecha|date:"d/m/Y H:i" }}</p>
    <p class="mb-0"><strong>{% trans "Personas" %}:</strong> {{ reserva.num_personas }}</p>
  </div>
</div>

<form method="post" class="card p-3">
  {% csrf_token %}
  <div class="mb-3">
    <label for="mesa_id" class="form-label">{% trans "Nueva mesa" %}</label>
    <select class="form-select" id="mesa_id" name="mesa_id" required>
      {% if candidatas %}
        {% for m in candidatas %}
          {% with waste=m.capacidad|add:-reserva.num_personas %}
          <option value="{{ m.id }}">
            Mesa {{ m.numero }} — cap {{ m.capacidad }} — waste {{ waste|default:0 }}
          </option>
          {% endwith %}
        {% endfor %}
      {% else %}
        <option value="">{% trans "No hay mesas candidatas" %}</option>
      {% endif %}
    </select>
  </div>

  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" value="1" id="forzar" name="forzar" {% if forzar %}checked{% endif %}>
    <label class="form-check-label" for="forzar">
      {% trans "Ignorar protección/waste (forzar)" %}
    </label>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">{% trans "Reasignar" %}</button>
    <a class="btn btn-outline-secondary" href="{% url 'reservas:panel_mesas' reserva.mesa.sucursal_id %}">{% trans "Cancelar" %}</a>
  </div>
</form>
