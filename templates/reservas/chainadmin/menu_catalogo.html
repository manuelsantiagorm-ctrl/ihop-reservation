{% extends "base.html" %}
{% load i18n static %}

{% block title %}{% trans "Catálogo de menú" %}{% endblock %}

{% block content %}
<div class="container py-3">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h1 class="h3 mb-1">{% trans "Catálogo de menú" %}</h1>
      <p class="text-muted small m-0">{% trans "Administra categorías, ítems y combos." %}</p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-primary" href="{% url 'reservas:chainadmin_menu_categoria_nueva' %}">
        <i class="bi bi-folder-plus"></i> {% trans "Nueva categoría" %}
      </a>
      <a class="btn btn-primary" href="{% url 'reservas:chainadmin_menu_item_nuevo' %}">
        <i class="bi bi-plus-lg"></i> {% trans "Nuevo ítem" %}
      </a>
    </div>
  </div>

  <form class="row g-2 mb-3">
    <div class="col-md-5">
      <input type="search" name="q" value="{{ q }}" class="form-control" placeholder="{% trans 'Buscar por código o nombre…' %}">
    </div>
    <div class="col-md-4">
      <select name="cat" class="form-select">
        <option value="">{% trans '(Todas las categorías)' %}</option>
        {% for c in categorias %}
          <option value="{{ c.id }}" {% if cat|add:'' == c.id|add:'' %}selected{% endif %}>{{ c.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <button class="btn btn-secondary w-100">{% trans "Filtrar" %}</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table align-middle table-sm">
      <thead class="table-light">
        <tr>
          <th>{% trans "Código" %}</th>
          <th>{% trans "Nombre" %}</th>
          <th>{% trans "Categoría" %}</th>
          <th class="text-end">{% trans "Precio" %}</th>
          <th class="text-center">{% trans "Activo" %}</th>
          <th>{% trans "Tipo" %}</th>
          <th class="text-end">{% trans "Acciones" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          <tr>
            <td><span class="badge text-bg-secondary">{{ it.codigo }}</span></td>
            <td>{{ it.nombre }}</td>
            <td>{{ it.categoria.nombre }}</td>
            <td class="text-end">
              {% if it.es_combo and it.precio_combo %}${{ it.precio_combo }}{% else %}${{ it.precio }}{% endif %}
            </td>
            <td class="text-center">
              {% if it.activo %}
                <span class="badge text-bg-success">{% trans "Sí" %}</span>
              {% else %}
                <span class="badge text-bg-secondary">{% trans "No" %}</span>
              {% endif %}
            </td>
            <td>
              {% if it.es_combo %}
                <span class="badge text-bg-info">{% trans "Combo" %}</span>
              {% else %}
                <span class="badge text-bg-light border">{% trans "Ítem" %}</span>
              {% endif %}
            </td>
            <td class="text-end">
              {% if it.es_combo %}
                <a class="btn btn-sm btn-outline-primary" href="{% url 'reservas:chainadmin_menu_combo' it.id %}">
                  <i class="bi bi-diagram-3"></i> {% trans "Componentes" %}
                </a>
              {% endif %}
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'reservas:chainadmin_menu_item_editar' it.id %}">
                {% trans "Editar" %}
              </a>
              <a class="btn btn-sm btn-outline-dark" href="{% url 'reservas:chainadmin_menu_item_toggle' it.id %}">
                {% if it.activo %}{% trans "Desactivar" %}{% else %}{% trans "Activar" %}{% endif %}
              </a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="7" class="text-center text-muted py-4">{% trans "Sin resultados." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <nav class="mt-3">
      <ul class="pagination pagination-sm">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ q }}&cat={{ cat }}">&laquo;</a></li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">{{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span></li>
        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ q }}&cat={{ cat }}">&raquo;</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}
