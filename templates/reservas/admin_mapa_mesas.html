{% extends 'base.html' %}
{% block content %}
<h2>Mapa de mesas — {{ sucursal.nombre }}</h2>

<p>
  <strong>Leyenda:</strong>
  <span style="display:inline-block;width:12px;height:12px;background:#16a34a;border-radius:2px;margin:0 4px;"></span> Disponible
  <span style="display:inline-block;width:12px;height:12px;background:#f59e0b;border-radius:2px;margin:0 8px 0 16px;"></span> Reservada
  <span style="display:inline-block;width:12px;height:12px;background:#dc2626;border-radius:2px;margin:0 4px 0 16px;"></span> Ocupada
  <span style="margin-left:16px;color:#666;">(ventana vigente = {{ total_minutos }} min)</span>
</p>

<p>
  <strong>Totales:</strong>
  Disponible: {{ totales.DISPONIBLE }} |
  Reservada: {{ totales.RESERVADA }} |
  Ocupada: {{ totales.OCUPADA }}
</p>

<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
  {% for mesa, estado, reserva in mesas_status %}
    {% if estado == 'DISPONIBLE' %}
      {% set bg = '#16a34a' %}{% set fg = 'white' %}
    {% elif estado == 'RESERVADA' %}
      {% set bg = '#f59e0b' %}{% set fg = 'black' %}
    {% else %}
      {% set bg = '#dc2626' %}{% set fg = 'white' %}
    {% endif %}

    <div style="border:1px solid #ddd;border-radius:10px;overflow:hidden;">
      <div style="background:{{ bg }};color:{{ fg }};padding:8px 12px;font-weight:600;">
        {{ mesa.nombre }} — {{ estado }}
      </div>
      <div style="padding:10px;font-size:14px;">
        <div><strong>Capacidad:</strong> {{ mesa.capacidad }} pax</div>
        {% if reserva %}
          <div><strong>Reserva:</strong> {{ reserva.fecha|date:"H:i" }} — {{ reserva.get_estado_display }}</div>
          <div><strong>Cliente:</strong> {{ reserva.cliente.nombre }}</div>
          <div><strong>Personas:</strong> {{ reserva.num_personas }}</div>
        {% else %}
          <div style="color:#666;">Sin reserva vigente</div>
        {% endif %}
        <div style="margin-top:8px;">
          <a href="{% url 'reservas:ver_mesas' sucursal.id %}">Ver detalle</a>
          {% if reserva %}
            &nbsp;|&nbsp;<a href="{% url 'reservas:admin_reservas' %}">Reservas</a>
          {% endif %}
        </div>
      </div>
    </div>
  {% empty %}
    <div>No hay mesas en esta sucursal.</div>
  {% endfor %}
</div>

<p style="margin-top:16px;">
  <a href="{% url 'reservas:admin_sucursales' %}">← Volver a sucursales</a>
</p>
{% endblock %}
