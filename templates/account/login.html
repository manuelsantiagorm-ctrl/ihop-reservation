{% extends "base.html" %}
{% load i18n static widget_tweaks socialaccount %}

{% block title %}{% trans "Iniciar sesión" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'reservas/css/auth.css' %}">
{% endblock %}

{% block content %}
<section class="auth-hero">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8 text-center">
        <h1 class="display-6 fw-bold mb-2">{% trans "Bienvenido de nuevo" %}</h1>
        <p class="text-secondary mb-0">
          {% trans "Accede para gestionar tus reservaciones y encontrar tu mesa en segundos." %}
        </p>
      </div>
    </div>
  </div>
</section>

<section class="auth-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-5">
        <div class="card shadow-sm auth-card">
          <div class="card-body p-4 p-md-5">

            {% if messages %}
              <div class="mb-3">
                {% for message in messages %}
                  <div class="alert alert-{{ message.tags|default:'info' }} mb-2 small">{{ message }}</div>
                {% endfor %}
              </div>
            {% endif %}

            <h2 class="h4 mb-1">{% trans "Iniciar sesión" %}</h2>
            <p class="text-secondary small mb-4">{% trans "Usa tu correo y contraseña para continuar." %}</p>

            {% if form.non_field_errors %}
              <div class="alert alert-danger small">
                {% for e in form.non_field_errors %}{{ e }}<br>{% endfor %}
              </div>
            {% endif %}

            <form method="post" action="{% url 'account_login' %}" novalidate>
              {% csrf_token %}

              <div class="mb-3">
                <label for="{{ form.login.id_for_label }}" class="form-label">{% trans "Correo electrónico" %}</label>
                {{ form.login|add_class:"form-control"|attr:"autocomplete=email,placeholder=tu@email.com" }}
                {% if form.login.errors %}
                  <div class="invalid-feedback d-block">
                    {% for e in form.login.errors %}{{ e }}{% endfor %}
                  </div>
                {% endif %}
              </div>

              <div class="mb-2">
                <label for="{{ form.password.id_for_label }}" class="form-label">{% trans "Contraseña" %}</label>
                <div class="input-group">
                  {{ form.password|add_class:"form-control"|attr:"autocomplete=current-password,placeholder=••••••••" }}
                  <button class="btn btn-outline-secondary" type="button" id="togglePwd" aria-label="{% trans 'Mostrar u ocultar contraseña' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                      <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8"/>
                      <path d="M8 5a3 3 0 1 0 0 6 3 3 0 0 0 0-6"/>
                    </svg>
                  </button>
                </div>
                {% if form.password.errors %}
                  <div class="invalid-feedback d-block">
                    {% for e in form.password.errors %}{{ e }}{% endfor %}
                  </div>
                {% endif %}
              </div>

              {% if form.remember %}
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <div class="form-check">
                    {{ form.remember|add_class:"form-check-input" }}
                    <label for="{{ form.remember.id_for_label }}" class="form-check-label">{% trans "Recordarme" %}</label>
                  </div>
                  <a class="small" href="{% url 'account_reset_password' %}">{% trans "¿Olvidaste tu contraseña?" %}</a>
                </div>
              {% else %}
                <div class="text-end mb-3">
                  <a class="small" href="{% url 'account_reset_password' %}">{% trans "¿Olvidaste tu contraseña?" %}</a>
                </div>
              {% endif %}

              <button type="submit" class="btn btn-primary w-100 mb-3">{% trans "Iniciar sesión" %}</button>

              {# --- Social login (Google) --- #}
              {% get_providers as providers %}
              {% if providers %}
                <div class="text-center text-secondary small my-3">{% trans "o continúa con" %}</div>
                <a href="{% provider_login_url 'google' process='login' %}" class="btn btn-outline-secondary w-100">
                  <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="" width="18" class="me-2">
                  Google
                </a>
              {% endif %}
            </form>

            <hr class="my-4">
            <p class="small mb-0">{% trans "¿Aún no tienes cuenta?" %} <a href="{% url 'account_signup' %}">{% trans "Crear cuenta" %}</a></p>
          </div>
        </div>

        <p class="text-center text-secondary small mt-3">
          {% trans "Al continuar aceptas nuestros términos y política de privacidad." %}
        </p>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'reservas/js/auth.js' %}"></script>
{% endblock %}
