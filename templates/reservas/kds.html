{% extends "base.html" %}
{% load static i18n %}

{% block title %}KDS Â· Cocina{% endblock %}

{% block content %}
<div class="container py-3">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <div>
      <h2 class="mb-0">ğŸ‘¨â€ğŸ³ {% trans "Panel de Cocina (KDS)" %}</h2>
      <small class="text-muted">
        {% blocktrans with m=minutes_visible %}
          Auto-actualizando cada 3s Â· mostrando SERVIDOS Ãºltimos {{ m }} min
        {% endblocktrans %}
      </small>
    </div>

    <div class="d-flex align-items-center gap-2">
      <label for="kdsMesaFilter" class="small text-muted mb-0">{% trans "Mesa" %}:</label>
      <select id="kdsMesaFilter" class="form-select form-select-sm" style="width:auto;">
        <option value="">{% trans "Todas" %}</option>
        {% for m in mesas_disponibles %}
          <option value="{{ m.numero }}" {% if mesa_filtro == m.numero|stringformat:"s" %}selected{% endif %}>
            Mesa {{ m.numero }}
          </option>
        {% endfor %}
      </select>

      <label for="kdsTimeFilter" class="small text-muted mb-0 ms-3">{% trans "Rango" %}:</label>
      <select id="kdsTimeFilter" class="form-select form-select-sm" style="width:auto;">
        <option value="">{% trans "Todas las horas" %}</option>
        <option value="30"  {% if rango_filtro == "30" %}selected{% endif %}>{% trans "Ãšltimos 30 min" %}</option>
        <option value="60"  {% if rango_filtro == "60" %}selected{% endif %}>{% trans "Ãšltima 1 h" %}</option>
        <option value="120" {% if rango_filtro == "120" %}selected{% endif %}>{% trans "Ãšltimas 2 h" %}</option>
        <option value="hoy" {% if rango_filtro == "hoy" %}selected{% endif %}>{% trans "Hoy" %}</option>
      </select>
    </div>
  </div>

  <div id="kds-grid"
       class="row g-3"
       data-data-url="{% url 'reservas:kds_data' %}"
       data-update-url-pattern="{% url 'reservas:kds_update_status' 0 %}"
       data-refresh-ms="3000">

    {# fallback por si JS estÃ¡ apagado #}
    {% if not orders %}
      <div class="col-12">
        <div class="alert alert-info mb-0">
          {% trans "No hay platillos en preparaciÃ³n." %}
        </div>
      </div>
    {% endif %}
  </div>
</div>

<script src="{% static 'reservas/js/kds.js' %}?v=20251202"></script>
{% endblock %}
